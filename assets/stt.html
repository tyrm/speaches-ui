<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>üçë Speaches UI - Speech to Text</title>
	<!-- Bootstrap 5.3 CSS -->
	<link href="/assets/css/bootstrap.min.css" rel="stylesheet">
	<style>
		:root {
			--primary-blue: #0052b3;
			--primary-green: #00a870;
			--gradient: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-green) 100%);
		}

		/* Navbar Styling */
		.navbar {
			background: var(--gradient);
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
		}

		.navbar-brand {
			font-size: 1.5rem;
			font-weight: 700;
			color: white !important;
		}

		.nav-link {
			color: rgba(255, 255, 255, 0.85) !important;
			margin-left: 1rem;
			transition: color 0.3s ease;
			font-weight: 500;
		}

		.nav-link:hover {
			color: white !important;
		}

		.nav-link.active {
			color: white !important;
			border-bottom: 2px solid white;
		}

		/* Main Content Area */
		body {
			background-color: #f8f9fa;
			padding-top: 80px;
		}

		.hero-section {
			background: var(--gradient);
			color: white;
			padding: 40px 0;
			margin-bottom: 40px;
			text-align: center;
		}

		.hero-section h1 {
			font-size: 2.5rem;
			font-weight: 700;
			margin-bottom: 10px;
		}

		.hero-section p {
			font-size: 1.1rem;
			opacity: 0.95;
		}

		/* Container Styling */
		.container-main {
			background: white;
			padding: 40px;
			border-radius: 10px;
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
			margin-bottom: 60px;
		}

		/* Form Layout */
		.form-layout {
			display: flex;
			gap: 30px;
			align-items: flex-start;
		}

		.form-left {
			flex: 1;
		}

		.form-right {
			width: 300px;
			flex-shrink: 0;
		}

		.form-group {
			margin-bottom: 20px;
		}

		label {
			font-weight: 600;
			color: #555;
			margin-bottom: 10px;
		}

		.form-control {
			border-color: #ddd;
			transition: border-color 0.3s ease, box-shadow 0.3s ease;
		}

		.form-control:focus {
			border-color: var(--primary-green);
			box-shadow: 0 0 0 0.2rem rgba(0, 168, 112, 0.25);
		}

		select.form-control {
			cursor: pointer;
			padding: 8px 12px;
			font-size: 14px;
		}

		select.form-control option {
			padding: 8px 12px;
		}

		textarea.form-control {
			resize: vertical;
			min-height: 400px !important;
			height: 400px !important;
			font-size: 16px;
			color: #666;
		}

		/* Audio Upload Controls */
		.upload-controls {
			display: flex;
			flex-direction: column;
			gap: 15px;
			margin-bottom: 20px;
			padding: 20px;
			background: #f8f9fa;
			border-radius: 8px;
			border: 1px solid #dee2e6;
		}

		.audio-input-section {
			display: flex;
			gap: 10px;
		}

		.form-file-input {
			flex: 1;
		}

		#audioFileInput {
			display: none;
		}

		.file-input-label {
			padding: 10px 15px;
			background: var(--gradient);
			color: white;
			border-radius: 5px;
			cursor: pointer;
			font-weight: 600;
			text-align: center;
			transition: all 0.3s ease;
			display: block;
		}

		.file-input-label:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 10px rgba(0, 82, 179, 0.3);
		}

		.audio-file-name {
			font-size: 13px;
			color: #666;
			margin-top: 8px;
			word-break: break-all;
		}

		.btn-transcribe {
			width: 100%;
			padding: 12px;
			font-size: 18px;
			font-weight: 600;
			background: var(--gradient);
			border: none;
			color: white;
			cursor: pointer;
			transition: all 0.3s ease;
			border-radius: 5px;
		}

		.btn-transcribe:hover:not(:disabled) {
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(0, 82, 179, 0.4);
		}

		.btn-transcribe:disabled {
			opacity: 0.6;
			cursor: not-allowed;
			transform: none;
		}

		/* Audio Player */
		.player-container {
			display: block;
			background: #f8f9fa;
			border: 1px solid #dee2e6;
			border-radius: 8px;
			padding: 15px;
			margin-bottom: 20px;
		}

		.player-controls {
			display: flex;
			align-items: center;
			gap: 10px;
			margin-bottom: 10px;
		}

		.play-btn {
			background: var(--gradient);
			color: white;
			border: none;
			padding: 8px 16px;
			border-radius: 5px;
			cursor: pointer;
			font-size: 14px;
			font-weight: 600;
			transition: all 0.3s ease;
			min-width: 80px;
		}

		.play-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 10px rgba(0, 82, 179, 0.3);
		}

		.play-btn:active {
			transform: translateY(0);
		}

		.progress-container {
			flex: 1;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.progress-bar {
			flex: 1;
			height: 6px;
			background: #dee2e6;
			border-radius: 3px;
			cursor: pointer;
			appearance: none;
			-webkit-appearance: none;
			width: 100%;
		}

		.progress-bar::-webkit-slider-thumb {
			appearance: none;
			-webkit-appearance: none;
			width: 14px;
			height: 14px;
			background: var(--gradient);
			border-radius: 50%;
			cursor: pointer;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
		}

		.progress-bar::-moz-range-thumb {
			width: 14px;
			height: 14px;
			background: var(--gradient);
			border-radius: 50%;
			cursor: pointer;
			border: none;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
		}

		.time-display {
			font-size: 12px;
			color: #666;
			white-space: nowrap;
			min-width: 50px;
			text-align: right;
		}

		/* Alerts */
		.alert {
			margin-top: 20px;
			display: none;
		}

		.alert.show {
			display: block;
		}

		#statusMessage {
			text-align: center;
			margin-top: 15px;
			font-size: 14px;
			color: #666;
			min-height: 20px;
		}

		/* Responsive */
		@media (max-width: 768px) {
			.form-layout {
				flex-direction: column;
				gap: 20px;
			}

			.form-right {
				width: 100%;
			}

			.hero-section h1 {
				font-size: 1.8rem;
			}

			.container-main {
				padding: 20px;
			}

			body {
				padding-top: 70px;
			}

			.recording-controls {
				padding: 15px;
			}
		}
	</style>
</head>
<body>
	<!-- Navigation Bar -->
	<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
		<div class="container-fluid">
			<a class="navbar-brand" href="/">üçë Speaches UI</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ms-auto">
					<li class="nav-item">
						<a class="nav-link" href="/">Text to Speech</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" aria-current="page" href="/stt">Speech to Text</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<!-- Hero Section -->
	<section class="hero-section">
		<div class="container">
			<h1>üëÇ Speech-to-Text</h1>
			<p>Convert speech to text with advanced transcription models</p>
		</div>
	</section>

	<!-- Main Content -->
	<div class="container">
		<div class="container-main" id="stt">
			<!-- Audio Upload Section -->
			<div class="upload-controls">
				<h5 style="margin-bottom: 15px; margin-top: 0;">Upload Audio File</h5>

				<!-- Audio File Input -->
				<div class="audio-input-section">
					<input type="file" id="audioFileInput" accept="audio/*">
					<label for="audioFileInput" class="file-input-label">üìÅ Choose Audio File</label>
					<div style="flex: 1; display: flex; align-items: center;">
						<span class="audio-file-name" id="fileName">No file selected</span>
					</div>
				</div>
			</div>

			<!-- Audio Player for playback -->
			<div id="playerContainer" class="player-container" style="display: none;">
				<div class="player-controls">
					<button id="playBtn" class="play-btn">‚ñ∂ Play</button>
					<div class="progress-container">
						<input type="range" id="progressBar" class="progress-bar" min="0" value="0">
						<span id="timeDisplay" class="time-display">0:00 / 0:00</span>
					</div>
				</div>
			</div>

			<!-- Hidden Audio Element -->
			<audio id="audioPlayer"></audio>

			<!-- STT Form -->
			<form id="sttForm">
				<div class="form-layout">
					<div class="form-left">
						<div class="form-group">
							<label for="transcriptOutput">Transcribed Text:</label>
							<textarea
								class="form-control"
								id="transcriptOutput"
								placeholder="Transcription will appear here..."
								readonly></textarea>
						</div>
					</div>
					<div class="form-right">
						<div class="form-group">
							<label for="languageSelect">Select Language:</label>
							<select class="form-control" id="languageSelect">
								<option value="en">English</option>
								<option value="es">Spanish</option>
								<option value="fr">French</option>
								<option value="de">German</option>
								<option value="it">Italian</option>
								<option value="pt">Portuguese</option>
								<option value="ja">Japanese</option>
								<option value="ko">Korean</option>
								<option value="zh">Chinese</option>
							</select>
						</div>
						<div class="form-group">
							<label for="modelSelect">Select Model:</label>
							<select class="form-control" id="modelSelect">
								<option value="fast">Fast (Lower accuracy)</option>
								<option value="standard">Standard (Balanced)</option>
								<option value="accurate">Accurate (Higher quality)</option>
							</select>
						</div>
						<button type="button" class="btn btn-transcribe" id="transcribeBtn">
							üéØ Transcribe
						</button>
						<div id="statusMessage"></div>
						<div id="errorAlert" class="alert alert-danger" role="alert"></div>
						<div id="successAlert" class="alert alert-success" role="alert"></div>
					</div>
				</div>
			</form>
		</div>
	</div>

	<!-- Bootstrap JS -->
	<script src="/assets/js/bootstrap.bundle.min.js"></script>
	<script>
		const audioFileInput = document.getElementById('audioFileInput');
		const fileName = document.getElementById('fileName');
		const transcribeBtn = document.getElementById('transcribeBtn');
		const transcriptOutput = document.getElementById('transcriptOutput');
		const languageSelect = document.getElementById('languageSelect');
		const modelSelect = document.getElementById('modelSelect');
		const audioPlayer = document.getElementById('audioPlayer');
		const playerContainer = document.getElementById('playerContainer');
		const playBtn = document.getElementById('playBtn');
		const progressBar = document.getElementById('progressBar');
		const timeDisplay = document.getElementById('timeDisplay');
		const errorAlert = document.getElementById('errorAlert');
		const successAlert = document.getElementById('successAlert');
		const statusMessage = document.getElementById('statusMessage');

		let audioUrl = null;
		let selectedAudioBlob = null;

		// File input handler
		audioFileInput.addEventListener('change', function(e) {
			const file = e.target.files[0];
			if (file) {
				fileName.textContent = file.name;
				selectedAudioBlob = file;

				if (audioUrl) {
					URL.revokeObjectURL(audioUrl);
				}
				audioUrl = URL.createObjectURL(file);
				audioPlayer.src = audioUrl;
				playerContainer.style.display = 'block';
				resetPlayer();

				hideAllAlerts();
				showSuccess('Audio file loaded successfully!');
			}
		});

		// Load saved preferences from localStorage
		function loadPreferences() {
			const savedLanguage = localStorage.getItem('stt-language');
			const savedModel = localStorage.getItem('stt-model');

			if (savedLanguage) {
				languageSelect.value = savedLanguage;
			}
			if (savedModel) {
				modelSelect.value = savedModel;
			}
		}

		// Save preferences
		function savePreferences() {
			localStorage.setItem('stt-language', languageSelect.value);
			localStorage.setItem('stt-model', modelSelect.value);
		}

		// Initialize
		loadPreferences();

		languageSelect.addEventListener('change', savePreferences);
		modelSelect.addEventListener('change', savePreferences);

		// Handle transcribe button click
		transcribeBtn.addEventListener('click', async function() {
			if (!selectedAudioBlob) {
				showError('Please select an audio file');
				return;
			}

			transcribeBtn.disabled = true;
			transcribeBtn.textContent = 'üéØ Transcribing...';
			statusMessage.textContent = 'Processing audio...';
			hideAllAlerts();

			try {
				const formData = new FormData();
				formData.append('audio', selectedAudioBlob);
				formData.append('language', languageSelect.value);
				formData.append('model', modelSelect.value);

				const response = await fetch('/api/stt', {
					method: 'POST',
					body: formData
				});

				if (!response.ok) {
					const errorData = await response.json();
					throw new Error(errorData.error || 'Failed to transcribe audio');
				}

				const result = await response.json();
				transcriptOutput.value = result.text || '';
				statusMessage.textContent = '';
				showSuccess('Transcription completed successfully!');

			} catch (error) {
				console.error('STT Error:', error);
				showError('Error: ' + error.message);
				statusMessage.textContent = '';
			} finally {
				transcribeBtn.disabled = false;
				transcribeBtn.textContent = 'üéØ Transcribe';
			}
		});

		// Play/Pause handler
		playBtn.addEventListener('click', function() {
			if (audioPlayer.paused) {
				audioPlayer.play();
			} else {
				audioPlayer.pause();
			}
			updatePlayButton();
		});

		audioPlayer.addEventListener('play', updatePlayButton);
		audioPlayer.addEventListener('pause', updatePlayButton);

		function updatePlayButton() {
			if (audioPlayer.paused) {
				playBtn.textContent = '‚ñ∂ Play';
			} else {
				playBtn.textContent = '‚è∏ Pause';
			}
		}

		// Progress bar seeking
		progressBar.addEventListener('input', function() {
			if (audioPlayer.duration) {
				audioPlayer.currentTime = (progressBar.value / 100) * audioPlayer.duration;
			}
		});

		audioPlayer.addEventListener('timeupdate', function() {
			if (audioPlayer.duration) {
				progressBar.value = (audioPlayer.currentTime / audioPlayer.duration) * 100;
			}
			updateTimeDisplay();
		});

		audioPlayer.addEventListener('loadedmetadata', function() {
			progressBar.max = 100;
			updateTimeDisplay();
		});

		audioPlayer.addEventListener('ended', function() {
			resetPlayer();
		});

		function resetPlayer() {
			progressBar.value = 0;
			updatePlayButton();
			updateTimeDisplay();
		}

		function updateTimeDisplay() {
			const current = formatTime(audioPlayer.currentTime);
			const duration = formatTime(audioPlayer.duration);
			timeDisplay.textContent = current + ' / ' + duration;
		}

		function formatTime(seconds) {
			if (!seconds || isNaN(seconds)) return '0:00';
			const mins = Math.floor(seconds / 60);
			const secs = Math.floor(seconds % 60);
			return mins + ':' + secs.toString().padStart(2, '0');
		}

		function showError(message) {
			errorAlert.textContent = message;
			errorAlert.classList.add('show');
			successAlert.classList.remove('show');
		}

		function showSuccess(message) {
			successAlert.textContent = message;
			successAlert.classList.add('show');
			errorAlert.classList.remove('show');
		}

		function hideAllAlerts() {
			errorAlert.classList.remove('show');
			successAlert.classList.remove('show');
		}
	</script>
</body>
</html>
